# TrackAttendance Environment Configuration
# Copy this file to .env and fill in your actual values
# .env is ignored by git and will never be committed

# Cloud API Configuration
CLOUD_API_URL=https://trackattendance-api-969370105809.asia-southeast1.run.app
# Generate with: openssl rand -hex 32 (must match API_KEY on the server)
CLOUD_API_KEY=your-api-key-here

# ============================================================================
# AUTO SYNC SETTINGS (Local check - NO API cost)
# ============================================================================
# These settings control when the app checks locally if pending scans need syncing.
# The check itself does NOT call the API - only actual sync uploads do.

# Maximum scans to upload per sync batch (prevents timeout on large uploads)
# Range: 50-500, Higher = faster sync but longer request time
CLOUD_SYNC_BATCH_SIZE=100

# Enable/disable automatic background sync
AUTO_SYNC_ENABLED=True

# Seconds of idle time (no scanning) before auto-sync triggers
# Prevents sync during active scanning sessions
# Range: 10-120, Lower = more responsive, Higher = less interruption
AUTO_SYNC_IDLE_SECONDS=30

# How often (seconds) to check if sync is needed (LOCAL check, no API call)
# This only checks: "Are there pending scans AND has idle time passed?"
# Range: 30-300, Does NOT affect API cost
AUTO_SYNC_CHECK_INTERVAL_SECONDS=60

# Minimum pending scans required before auto-sync triggers
# Set higher to batch more scans before uploading
# Range: 1-50, 1 = sync immediately when idle, Higher = batch more
AUTO_SYNC_MIN_PENDING_SCANS=1

# Show status messages when auto-sync starts/completes
AUTO_SYNC_SHOW_START_MESSAGE=True
AUTO_SYNC_SHOW_COMPLETE_MESSAGE=True

# How long (ms) to show sync status message in UI
AUTO_SYNC_MESSAGE_DURATION_MS=3000

# Timeout (seconds) for sync HTTP requests
AUTO_SYNC_CONNECTION_TIMEOUT=5

# ============================================================================
# Sync Resilience (Retry & Failure Handling)
# ============================================================================
# Retry failed sync operations with exponential backoff
SYNC_RETRY_ENABLED=True
SYNC_RETRY_MAX_ATTEMPTS=3
SYNC_RETRY_BACKOFF_SECONDS=5

# Auto-sync pauses after consecutive failures to prevent hammering
AUTO_SYNC_MAX_CONSECUTIVE_FAILURES=5
# Cooldown (seconds) before retrying after max failures reached
AUTO_SYNC_FAILURE_COOLDOWN_SECONDS=300

# ============================================================================
# CONNECTION HEALTH CHECK (API cost - adjust for multi-machine deployments)
# ============================================================================
# These settings poll the API to check if connection is alive.
# IMPORTANT: Each check = 1 API call. Multiply by number of machines!
#
# Example: 10 machines at event
#   - 60s interval = 10 calls/min = 600 calls/hr (recommended)
#   - 20s interval = 30 calls/min = 1,800 calls/hr (expensive)
#   - 120s interval = 5 calls/min = 300 calls/hr (economical)
#
# For large events (10+ machines): Use 60-120 seconds
# For single machine: 20-60 seconds is fine

# Connection check interval (seconds). Set to 0 to disable polling entirely.
# Recommended: 60s for events, 20-30s for development/testing
CONNECTION_CHECK_INTERVAL_SECONDS=60

# Timeout for each health check request
CONNECTION_CHECK_TIMEOUT_SECONDS=10

# Delay before first connection check after app startup
# Allows app to fully load before checking connection
CONNECTION_CHECK_INITIAL_DELAY_SECONDS=10

# Hysteresis: Requires 2 consecutive failures before showing offline indicator
# This prevents flicker from transient network issues

# ============================================================================
# UI Settings
# ============================================================================
SHOW_FULL_SCREEN=True
ENABLE_FADE_ANIMATION=True
AUTO_EXPORT_ON_SHUTDOWN=True

# Party/Event background image (disco balls) - v1.4.0+
# Set to True for festive events, False for plain grey background
SHOW_PARTY_BACKGROUND=False

# Duplicate Badge Detection (Issue #20, #21)
# Prevent users from scanning the same badge multiple times in quick succession
DUPLICATE_BADGE_DETECTION_ENABLED=True
DUPLICATE_BADGE_TIME_WINDOW_SECONDS=300
# Action: 'warn' (accept + alert), 'block' (reject), 'silent' (accept + no alert)
DUPLICATE_BADGE_ACTION=block
# Alert duration in milliseconds (2000ms = 2 seconds, default duration)
# Includes fade-in/out animation (300ms) and bounce scale effect
DUPLICATE_BADGE_ALERT_DURATION_MS=3000

# Duration (ms) to show employee name and "THANK YOU" after scan
# before returning to "Ready to scan..." state
# Range: 1000-5000, Higher = longer display, Lower = faster reset
SCAN_FEEDBACK_DURATION_MS=5000

# ============================================================================
# Voice Playback
# ============================================================================
# Play a random voice clip from assets/voices/ on successful badge scan
VOICE_ENABLED=True
# Playback volume (0.0 = muted, 1.0 = full volume)
VOICE_VOLUME=1.0

# ============================================================================
# Camera Proximity Detection (Optional Plugin)
# ============================================================================
# When enabled, the camera detects people approaching the kiosk and plays
# a voice greeting prompting them to scan their badge.
# Camera does NOT scan barcodes â€” badge scanning remains USB-only.
# Requires: opencv-python-headless, numpy (mediapipe optional for better detection)
ENABLE_CAMERA_DETECTION=True

# -- Hardware --
# Camera device index (0 = built-in laptop camera, 1+ = external)
CAMERA_DEVICE_ID=0
# Camera capture resolution (1280x720 default, lower for less CPU)
CAMERA_RESOLUTION_WIDTH=1280
CAMERA_RESOLUTION_HEIGHT=720
# Camera overlay: True = live preview (debug), False = status icon only (production)
CAMERA_SHOW_OVERLAY=True

# -- Greeting behavior --
# Minimum seconds between greetings (prevents "revolving door" repeats)
CAMERA_GREETING_COOLDOWN_SECONDS=60
# Seconds to suppress greetings after a badge scan (quiet during busy queues)
CAMERA_SCAN_BUSY_SECONDS=30

# -- Detection tuning --
# Minimum detection size as fraction of frame width (filters distant people)
# 0.20 = face must fill 20% of frame (~0.5-1m). Range: 0.05-0.80
CAMERA_MIN_SIZE_PCT=0.20
# Seconds with no person before resetting to "empty" (ready for next greeting)
CAMERA_ABSENCE_THRESHOLD_SECONDS=3
# Consecutive frames required before greeting fires (prevents false positives)
# Higher = fewer false positives but slower response. Range: 1-15
CAMERA_CONFIRM_FRAMES=3
# Haar cascade strictness (only when MediaPipe unavailable)
# Higher = fewer false positives. 3 = sensitive, 5 = balanced, 8+ = strict
CAMERA_HAAR_MIN_NEIGHBORS=5

# ============================================================================
# Roster Validation
# ============================================================================
# Show warning if roster (employee.xlsx) is missing or invalid
ROSTER_VALIDATION_ENABLED=True
# Strict: skip import entirely if required columns are missing
ROSTER_STRICT_VALIDATION=True

# ============================================================================
# Debug & Logging
# ============================================================================
# DEBUG=True disables auto-focus to allow copying debug console output
DEBUG=False
# Enable file logging (logs/trackattendance.log)
LOGGING_ENABLED=True
LOGGING_FILE=logs/trackattendance.log
# LOGGING_LEVEL: Sets Python logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOGGING_LEVEL=INFO
# Enable console logging output
LOGGING_CONSOLE=True

# ============================================================================
# Public Dashboard
# ============================================================================
# Mobile-friendly attendance dashboard (no auth required)
# URL: https://<your-cloud-run-url>/dashboard/
# API: /v1/dashboard/public/stats (30s polling, auto-refresh)
# Roster BU counts synced automatically on first successful health check

# ============================================================================
# Admin Features
# ============================================================================
# PIN for admin features (4-6 digits). Leave empty to disable admin features.
# Used for: Clear Cloud Database before events
ADMIN_PIN=1234
