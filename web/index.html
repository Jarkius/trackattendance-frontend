<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Track Attendance</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%2386bc25%22></circle></svg>">

    <!-- Materialize CSS -->
    <link rel="stylesheet" href="materialize/css/materialize.min.css">
    <!-- Local Fonts -->
    <link rel="stylesheet" href="css/fonts.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/material-icons.css">
</head>

<body class="party-bg">
    <header>
        <div class="header-inner">
            <h1>Station : <span id="station-name">--</span></h1>
        </div>
        <span class="connection-status connection-status--unknown" id="connection-status" aria-label="API connection status" title="Checking connection"></span>
        <span class="voice-toggle voice-toggle--hidden" id="voice-toggle" title="Voice Confirmation">
            <svg class="voice-toggle__on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
            <svg class="voice-toggle__off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
            </svg>
        </span>
        <span class="camera-toggle camera-toggle--hidden" id="camera-toggle" title="Camera Detection">
            <svg class="camera-toggle__on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
            </svg>
            <svg class="camera-toggle__off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"/>
            </svg>
        </span>
        <span class="dashboard-icon" id="dashboard-icon" title="View Dashboard">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
            </svg>
        </span>
    </header>
    <i id="close-btn" class="material-icons">close</i>

    <!-- Debug Console (temporary) -->
    <div id="debug-console" style="position: fixed; bottom: 10px; left: 10px; width: 400px; max-height: 250px; background: rgba(0,0,0,0.9); color: #0f0; font-family: monospace; font-size: 10px; padding: 8px; overflow-y: auto; z-index: 9999; display: none; border: 1px solid #0f0;">
        <div style="color: #f0f; margin-bottom: 5px; cursor: pointer; text-decoration: underline;" onclick="document.getElementById('debug-status').textContent = JSON.stringify(window.localStorage, null, 2);">LocalStorage DEBUG DATA (Click to view)</div>
        <div id="debug-status" style="color: #ff0; margin-bottom: 5px; white-space: pre-wrap; word-break: break-word;"></div>
        <div style="color: #f0f; margin-bottom: 5px;">CONSOLE LOG:</div>
        <div id="debug-output"></div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Left Panel: Input and Feedback -->
            <div class="col s12 m7 l8 left-panel-content">
                <div id="main-panel">
                    <div class="main-content-wrapper">
                        <div class="feedback-section">
                            <div class="export-overlay" id="export-overlay" aria-hidden="true">
                                <div class="export-overlay__dialog">
                                    <h5 class="export-overlay__title" id="export-overlay-title">Export Complete</h5>
                                    <p class="export-overlay__message" id="export-overlay-message"></p>
                                    <button type="button" class="export-overlay__button export-btn export-overlay__button--hidden" id="export-overlay-confirm">Close Application</button>
                                </div>
                            </div>
                            <!-- Duplicate Badge Alert (Issue #21) - Uses export overlay pattern -->
                            <div class="duplicate-overlay" id="duplicate-overlay" aria-hidden="true">
                                <div class="duplicate-overlay__dialog">
                                    <h5 class="duplicate-overlay__title" id="duplicate-overlay-title"></h5>
                                    <p class="duplicate-overlay__message" id="duplicate-overlay-message"></p>
                                    <p class="duplicate-overlay__badge" id="duplicate-overlay-badge"></p>
                                    <p class="duplicate-overlay__name" id="duplicate-overlay-name"></p>
                                </div>
                            </div>
                            <!-- Employee Lookup Overlay (forgot-badge flow) -->
                            <div class="lookup-overlay" id="lookup-overlay" aria-hidden="true">
                                <div class="lookup-overlay__dialog">
                                    <h5 class="lookup-overlay__title">Employee Lookup</h5>
                                    <p class="lookup-overlay__search" id="lookup-search-query"></p>
                                    <div class="lookup-overlay__results" id="lookup-results"></div>
                                    <div class="lookup-overlay__actions">
                                        <button class="lookup-overlay__btn lookup-overlay__btn--cancel" id="lookup-cancel">Cancel</button>
                                    </div>
                                </div>
                            </div>
                            <h5 id="welcome-heading">WELCOME</h5>
                            <p id="live-feedback-name">Ready to scan...</p>
                            <div class="scan-section">
                                <input type="text" id="barcode-input" placeholder="Scan Badge Barcode" autofocus>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Dashboard and History -->
            <div class="col s12 m5 l4">
                <div class="sidebar">
                    <div class="dashboard-section card">
                        <div class="card-content">
                            <span class="card-title">Dashboard</span>
                            <div class="row">
                                <div class="col s6">
                                    <div class="counter">
                                        <span class="count" id="total-employees">0</span>
                                        <span class="label">Total Employees</span>
                                    </div>
                                </div>
                                <div class="col s6">
                                    <div class="counter">
                                        <span class="count" id="total-scanned">0</span>
                                        <span class="label">Scanned Today</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Compact Sync Status -->
                            <div class="sync-status-compact">
                                <div class="sync-stats-row">
                                    <div class="sync-stats-inline">
                                        <span class="sync-stat-inline">
                                            <span class="sync-label-inline">Pending:</span>
                                            <span class="sync-value-inline" id="sync-pending">-</span>
                                        </span>
                                        <span class="sync-stat-inline">
                                            <span class="sync-label-inline">Synced:</span>
                                            <span class="sync-value-inline" id="sync-synced">-</span>
                                        </span>
                                        <span class="sync-stat-inline">
                                            <span class="sync-label-inline">Failed:</span>
                                            <span class="sync-value-inline" id="sync-failed">-</span>
                                        </span>
                                    </div>
                                    <button class="sync-icon-btn" id="sync-now-btn" title="Sync Now">
                                        <i class="material-icons">sync</i>
                                    </button>
                                </div>
                                <p class="sync-status-message" id="sync-status-message"></p>
                            </div>
                        </div>
                    </div>

                    <div class="history-section card">
                        <div class="card-content">
                            <span class="card-title">Recent Scans</span>
                            <ul class="collection" id="scan-history-list">
                                <!-- History items will be added here -->
                                <li class="collection-item collection-item--placeholder">
                                    <span class="history-header">
                                        <span class="history-label">Awaiting first scan</span>
                                        <span class="history-timestamp">--:--:--</span>
                                    </span>
                                    <span class="history-meta">Scan a badge to populate recent history.</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Export Button Section -->
                    <div class="export-section">
                        <button class="export-btn" id="export-data-btn">
                            <i class="material-icons">file_download</i>
                            Export Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Multi-Station Dashboard Panel (Issue #27 + #28) -->
    <div class="dash" id="dashboard-overlay" aria-hidden="true">
      <div class="dash__modal">
        <!-- Top bar with title, stats, and actions -->
        <header class="dash__header">
            <div class="dash__brand">
                <span class="dash__logo">ATTENDANCE</span>
                <span class="dash__subtitle">Live Dashboard</span>
            </div>
            <div class="dash__stats">
                <div class="dash__stat">
                    <span class="dash__stat-value" id="dashboard-registered">--</span>
                    <span class="dash__stat-label">Total</span>
                </div>
                <div class="dash__stat dash__stat--primary">
                    <span class="dash__stat-value" id="dashboard-scanned">--</span>
                    <span class="dash__stat-label">Scanned</span>
                </div>
                <div class="dash__stat dash__stat--accent">
                    <span class="dash__stat-value" id="dashboard-rate">--%</span>
                    <span class="dash__stat-label">Rate</span>
                </div>
            </div>
            <div class="dash__actions">
                <span class="dash__time" id="dashboard-updated">--</span>
                <button class="dash__btn" id="dashboard-refresh" title="Refresh"><i class="material-icons">refresh</i></button>
                <button class="dash__btn dash__btn--export" id="dashboard-export" title="Export"><i class="material-icons">download</i></button>
                <button class="dash__btn dash__btn--admin" id="dashboard-admin" title="Admin" style="display:none;"><i class="material-icons">settings</i></button>
                <button class="dash__btn dash__btn--close" id="dashboard-close" title="Close"><i class="material-icons">close</i></button>
            </div>
        </header>

        <!-- Main content: two columns -->
        <main class="dash__body">
            <!-- Stations Column -->
            <section class="dash__col">
                <h2 class="dash__col-title"><i class="material-icons">sensors</i> Stations</h2>
                <div class="dash__grid dash__grid--stations" id="dashboard-stations-body">
                    <div class="dash__empty">Loading...</div>
                </div>
            </section>

            <!-- Business Units Column -->
            <section class="dash__col">
                <h2 class="dash__col-title"><i class="material-icons">domain</i> Business Units</h2>
                <div class="dash__grid dash__grid--bu" id="dashboard-bu-body">
                    <div class="dash__empty">Loading...</div>
                </div>
            </section>
        </main>
        <footer class="dash__footer" id="dashboard-footer" style="display:none;">
            <i class="material-icons" style="font-size:16px;">description</i>
            <a href="#" id="dashboard-export-link" class="dash__footer-link"></a>
        </footer>
      </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="admin-overlay" id="admin-overlay" aria-hidden="true">
        <div class="admin-overlay__dialog">
            <div id="admin-pin-view">
                <h5 class="admin-overlay__title">Admin Access</h5>
                <p class="admin-overlay__subtitle">Enter PIN to continue</p>
                <input type="password" id="admin-pin-input" maxlength="6" placeholder="Enter PIN" inputmode="numeric" pattern="[0-9]*" autocomplete="off">
                <p class="admin-overlay__error" id="admin-pin-error"></p>
                <div class="admin-overlay__actions">
                    <button class="admin-overlay__btn admin-overlay__btn--cancel" id="admin-cancel">Cancel</button>
                    <button class="admin-overlay__btn admin-overlay__btn--submit" id="admin-pin-submit">Submit</button>
                </div>
            </div>
            <div id="admin-actions-view" style="display:none;">
                <h5 class="admin-overlay__title">Admin Panel</h5>
                <div class="admin-overlay__section">
                    <p id="admin-cloud-count">Checking scan count...</p>
                    <p id="admin-local-count" style="margin-top:4px;font-size:13px;color:#999;"></p>
                    <button class="admin-overlay__btn admin-overlay__btn--warning" id="admin-clear-station" style="margin-bottom:8px;">
                        <i class="material-icons">location_off</i> Clear This Station
                    </button>
                    <button class="admin-overlay__btn admin-overlay__btn--danger" id="admin-clear-cloud">
                        <i class="material-icons">delete_forever</i> Clear All Stations
                    </button>
                </div>
                <div class="admin-overlay__actions">
                    <button class="admin-overlay__btn admin-overlay__btn--cancel" id="admin-close">Close</button>
                </div>
            </div>
            <div id="admin-confirm-view" style="display:none;">
                <h5 class="admin-overlay__title" style="color:#c62828;" id="admin-confirm-title">Confirm Deletion</h5>
                <p id="admin-confirm-message">This will permanently delete data. A backup will be exported first.</p>
                <p style="margin:12px 0 4px;font-size:13px;color:#999;">Type this code to confirm:</p>
                <div class="admin-confirm-code" id="admin-confirm-code"></div>
                <input type="text" id="admin-confirm-code-input" maxlength="4" placeholder="Enter code" inputmode="numeric" pattern="[0-9]*" autocomplete="off" style="text-align:center;font-size:20px;letter-spacing:8px;max-width:160px;margin:8px auto;display:block;">
                <div class="admin-overlay__actions">
                    <button class="admin-overlay__btn admin-overlay__btn--cancel" id="admin-confirm-cancel">Cancel</button>
                    <button class="admin-overlay__btn admin-overlay__btn--danger" id="admin-confirm-delete" disabled>Delete</button>
                </div>
            </div>
            <div id="admin-result-view" style="display:none;">
                <h5 class="admin-overlay__title" id="admin-result-title">Done</h5>
                <p id="admin-result-message"></p>
                <div class="admin-overlay__actions">
                    <button class="admin-overlay__btn admin-overlay__btn--cancel" id="admin-result-close">Close</button>
                </div>
            </div>
            <div id="admin-status-view" style="display:none;">
                <h5 class="admin-overlay__title">Station Status</h5>
                <div id="admin-station-list" class="admin-station-list"></div>
                <p id="admin-station-summary" style="margin-top:8px;font-size:13px;color:#999;"></p>
                <div class="admin-overlay__actions">
                    <button class="admin-overlay__btn admin-overlay__btn--cancel" id="admin-status-close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Materialize JavaScript -->
    <script src="materialize/js/materialize.min.js"></script>
    <!-- Qt WebChannel Script -->
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <!-- Custom Script -->
    <script src="script.js"></script>

</body>
</html>
